# ğŸ¢ GitSync-Bridge v3.0 ä¼ä¸šçº§é…ç½®
# é€‚ç”¨äºä¼ä¸šçº§é¡¹ç›®çš„é«˜å¯ç”¨åŒå‘åŒæ­¥
# åŒ…å«é€šçŸ¥ç³»ç»Ÿã€è¯¦ç»†ç›‘æ§ã€è‡ªåŠ¨å›æ»šç­‰ä¼ä¸šç‰¹æ€§

name: ğŸ¢ Enterprise GitSync-Bridge v3.0

on:
  push:
    branches: [ main, master, develop, release/* ]
  pull_request:
    branches: [ main, master ]
  schedule:
    - cron: '0 */2 * * *'  # æ¯2å°æ—¶è‡ªåŠ¨æ£€æŸ¥
  workflow_dispatch:
    inputs:
      force_sync:
        description: 'å¼ºåˆ¶åŒæ­¥'
        type: boolean
        default: false
      dry_run:
        description: 'æ¨¡æ‹Ÿè¿è¡Œ (ä¸å®é™…æ‰§è¡Œ)'
        type: boolean  
        default: false
      notification_level:
        description: 'é€šçŸ¥çº§åˆ«'
        type: choice
        options:
          - 'all'      # æ‰€æœ‰äº‹ä»¶
          - 'errors'   # ä»…é”™è¯¯
          - 'success'  # ä»…æˆåŠŸ
          - 'none'     # æ— é€šçŸ¥
        default: 'errors'

env:
  # ä»“åº“é…ç½®
  GITHUB_USERNAME: ${{ github.repository_owner }}
  GITHUB_REPO: ${{ github.event.repository.name }}  
  GITEE_USERNAME: ${{ vars.GITEE_USERNAME || github.repository_owner }}
  GITEE_REPO: ${{ vars.GITEE_REPO || github.event.repository.name }}
  
  # ä¼ä¸šé…ç½®
  ENTERPRISE_MODE: true
  MAX_RETRY_COUNT: 5
  SYNC_TIMEOUT: 1800  # 30åˆ†é’Ÿ
  BACKUP_ENABLED: true

jobs:
  # Job 1: ä¼ä¸šçº§é¢„æ£€æŸ¥
  enterprise-precheck:
    runs-on: ubuntu-latest
    name: ğŸ” ä¼ä¸šé¢„æ£€æŸ¥
    outputs:
      should_proceed: ${{ steps.precheck.outputs.should_proceed }}
      network_quality: ${{ steps.precheck.outputs.network_quality }}
      security_check: ${{ steps.precheck.outputs.security_check }}
      
    steps:
      - name: ğŸ“¥ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        with:
          fetch-depth: 50  # è·å–æ›´å¤šå†å²ç”¨äºåˆ†æ
          
      - name: ğŸ” ä¼ä¸šçº§é¢„æ£€æŸ¥
        id: precheck
        run: |
          echo "ğŸ¢ GitSync-Bridge v3.0 ä¼ä¸šçº§é¢„æ£€æŸ¥"
          echo "====================================="
          
          # å®‰å…¨æ£€æŸ¥
          echo "ğŸ”’ å®‰å…¨æ£€æŸ¥:"
          SECURITY_SCORE=100
          
          # æ£€æŸ¥æ˜¯å¦æœ‰æ•æ„Ÿä¿¡æ¯
          if grep -r -i "password\|secret\|token\|key" . --exclude-dir=.git >/dev/null 2>&1; then
            echo "âš ï¸ è­¦å‘Š: å‘ç°å¯èƒ½çš„æ•æ„Ÿä¿¡æ¯"
            SECURITY_SCORE=$((SECURITY_SCORE - 20))
          else
            echo "âœ… æœªå‘ç°æ˜æ˜¾çš„æ•æ„Ÿä¿¡æ¯"
          fi
          
          # æ£€æŸ¥å¤§æ–‡ä»¶
          LARGE_FILES=$(find . -type f -size +50M 2>/dev/null | wc -l)
          if [ $LARGE_FILES -gt 0 ]; then
            echo "âš ï¸ å‘ç° $LARGE_FILES ä¸ªå¤§æ–‡ä»¶ (>50MB)"
            SECURITY_SCORE=$((SECURITY_SCORE - 10))
          else
            echo "âœ… æ–‡ä»¶å¤§å°æ£€æŸ¥é€šè¿‡"
          fi
          
          echo "ğŸ”’ å®‰å…¨è¯„åˆ†: $SECURITY_SCORE/100"
          echo "security_check=$SECURITY_SCORE" >> $GITHUB_OUTPUT
          
          # ç½‘ç»œè´¨é‡æ£€æŸ¥
          echo ""
          echo "ğŸŒ ç½‘ç»œè´¨é‡æ£€æŸ¥:"
          
          # æµ‹è¯•å¤šä¸ªåœ°ç†ä½ç½®çš„è¿æ¥
          NETWORK_SCORE=0
          TOTAL_TESTS=0
          
          for endpoint in "gitee.com" "github.com" "raw.githubusercontent.com"; do
            TOTAL_TESTS=$((TOTAL_TESTS + 1))
            if timeout 10 curl -s --connect-timeout 5 "https://$endpoint" >/dev/null 2>&1; then
              NETWORK_SCORE=$((NETWORK_SCORE + 1))
              echo "âœ… $endpoint è¿æ¥æ­£å¸¸"
            else
              echo "âŒ $endpoint è¿æ¥å¤±è´¥"
            fi
          done
          
          NETWORK_QUALITY=$((NETWORK_SCORE * 100 / TOTAL_TESTS))
          echo "ğŸŒ ç½‘ç»œè´¨é‡: $NETWORK_QUALITY%"
          echo "network_quality=$NETWORK_QUALITY" >> $GITHUB_OUTPUT
          
          # å†³ç­–é€»è¾‘
          if [ $SECURITY_SCORE -ge 80 ] && [ $NETWORK_QUALITY -ge 60 ]; then
            echo "âœ… é¢„æ£€æŸ¥é€šè¿‡ï¼Œå¯ä»¥ç»§ç»­åŒæ­¥"
            echo "should_proceed=true" >> $GITHUB_OUTPUT
          else
            echo "âŒ é¢„æ£€æŸ¥æœªé€šè¿‡ï¼Œå»ºè®®äººå·¥å®¡æŸ¥"
            echo "should_proceed=false" >> $GITHUB_OUTPUT
          fi
          
          echo ""
          echo "ğŸ“Š é¢„æ£€æŸ¥æ‘˜è¦:"
          echo "  - å®‰å…¨è¯„åˆ†: $SECURITY_SCORE/100"
          echo "  - ç½‘ç»œè´¨é‡: $NETWORK_QUALITY%"
          echo "  - å»ºè®®æ“ä½œ: $([ $SECURITY_SCORE -ge 80 ] && [ $NETWORK_QUALITY -ge 60 ] && echo 'ç»§ç»­åŒæ­¥' || echo 'æš‚åœåŒæ­¥')"

  # Job 2: ä¼ä¸šçº§GitHub â†’ GiteeåŒæ­¥
  enterprise-github-to-gitee:
    needs: enterprise-precheck
    if: |
      always() && 
      needs.enterprise-precheck.outputs.should_proceed == 'true' &&
      (github.event_name == 'push' || github.event_name == 'workflow_dispatch')
    runs-on: ubuntu-latest
    name: ğŸ¢ GitHub â†’ Gitee (ä¼ä¸šç‰ˆ)
    
    steps:
      - name: ğŸ“¥ æ£€å‡ºä»£ç  (ä¼ä¸šçº§)
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}
          
      - name: ğŸ›¡ï¸ ä¼ä¸šçº§Gité…ç½®
        run: |
          echo "ğŸ›¡ï¸ é…ç½®ä¼ä¸šçº§Gitç¯å¢ƒ"
          
          # åŸºç¡€é…ç½®
          git config --global user.name "GitSync-Bridge Enterprise[bot]"
          git config --global user.email "enterprise@gitsync-bridge.com"
          
          # ä¼ä¸šçº§å®‰å…¨é…ç½®
          git config --global http.sslVerify true
          git config --global core.autocrlf false
          git config --global core.trustctime false
          
          # æ€§èƒ½ä¼˜åŒ–é…ç½®
          git config --global core.preloadindex true
          git config --global core.fscache true
          git config --global gc.auto 0  # ç¦ç”¨è‡ªåŠ¨GC
          git config --global pack.threads 0  # ä½¿ç”¨æ‰€æœ‰CPUæ ¸å¿ƒ
          
          # ç½‘ç»œä¼˜åŒ–é…ç½®
          git config --global http.postBuffer 1048576000  # 1GB buffer
          git config --global http.lowSpeedLimit 1000
          git config --global http.lowSpeedTime 900       # 15åˆ†é’Ÿè¶…æ—¶
          
          echo "âœ… ä¼ä¸šçº§Gité…ç½®å®Œæˆ"
          
      - name: ğŸ”„ ä¼ä¸šçº§åŒæ­¥åˆ°Gitee
        id: enterprise_sync
        run: |
          echo "ğŸ¢ å¼€å§‹ä¼ä¸šçº§åŒæ­¥åˆ°Gitee"
          echo "=========================="
          
          # ä¼ä¸šçº§åŒæ­¥çŠ¶æ€è·Ÿè¸ª
          SYNC_START_TIME=$(date +%s)
          SYNC_ID="sync-$(date +%Y%m%d-%H%M%S)"
          
          echo "ğŸ†” åŒæ­¥ID: $SYNC_ID"
          echo "ğŸ“Š å¼€å§‹æ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')"
          
          # é¢„åŒæ­¥å¤‡ä»½ (ä¼ä¸šç‰¹æ€§)
          if [[ "${{ env.BACKUP_ENABLED }}" == "true" ]]; then
            echo "ğŸ’¾ åˆ›å»ºé¢„åŒæ­¥å¤‡ä»½..."
            git tag "backup-before-$SYNC_ID" HEAD
            echo "âœ… å¤‡ä»½æ ‡ç­¾åˆ›å»º: backup-before-$SYNC_ID"
          fi
          
          # è·å–è¯¦ç»†çš„ä»“åº“çŠ¶æ€
          CURRENT_COMMIT=$(git rev-parse HEAD)
          CURRENT_COMMIT_SHORT=$(git rev-parse --short HEAD)
          CURRENT_BRANCH=$(git branch --show-current)
          COMMIT_MESSAGE=$(git log -1 --pretty=format:"%s")
          COMMIT_AUTHOR=$(git log -1 --pretty=format:"%an")
          REPO_SIZE=$(du -sh .git | cut -f1)
          
          echo "ğŸ“Š ä»“åº“çŠ¶æ€:"
          echo "  - å½“å‰åˆ†æ”¯: $CURRENT_BRANCH"
          echo "  - æäº¤å“ˆå¸Œ: $CURRENT_COMMIT_SHORT"
          echo "  - æäº¤ä¿¡æ¯: $COMMIT_MESSAGE"
          echo "  - æäº¤ä½œè€…: $COMMIT_AUTHOR"
          echo "  - ä»“åº“å¤§å°: $REPO_SIZE"
          
          # æ·»åŠ Giteeè¿œç¨‹ä»“åº“ (å¸¦èº«ä»½éªŒè¯)
          GITEE_URL="https://${{ env.GITEE_USERNAME }}:${{ secrets.GITEE_PASSWORD }}@gitee.com/${{ env.GITEE_USERNAME }}/${{ env.GITEE_REPO }}.git"
          git remote add gitee "$GITEE_URL" || git remote set-url gitee "$GITEE_URL"
          
          # ä¼ä¸šçº§é‡è¯•é€»è¾‘
          SUCCESS=false
          for attempt in $(seq 1 ${{ env.MAX_RETRY_COUNT }}); do
            echo ""
            echo "ğŸ”„ åŒæ­¥å°è¯• $attempt/${{ env.MAX_RETRY_COUNT }}"
            echo "------------------------"
            
            # å¢åŠ æ¯æ¬¡é‡è¯•çš„è¶…æ—¶æ—¶é—´
            TIMEOUT=$((300 + attempt * 60))
            echo "â° æœ¬æ¬¡å°è¯•è¶…æ—¶: ${TIMEOUT}ç§’"
            
            if timeout $TIMEOUT git push gitee $CURRENT_BRANCH --force-with-lease; then
              SUCCESS=true
              echo "âœ… åŒæ­¥æˆåŠŸï¼"
              break
            else
              echo "âŒ ç¬¬${attempt}æ¬¡åŒæ­¥å¤±è´¥"
              
              if [ $attempt -lt ${{ env.MAX_RETRY_COUNT }} ]; then
                WAIT_TIME=$((attempt * 15))
                echo "â³ ç­‰å¾… ${WAIT_TIME}ç§’ åé‡è¯•..."
                sleep $WAIT_TIME
                
                # è¯Šæ–­ç½‘ç»œçŠ¶æ€
                echo "ğŸ” ç½‘ç»œè¯Šæ–­:"
                curl -I --connect-timeout 10 https://gitee.com/ || echo "  - Giteeè¿æ¥å¼‚å¸¸"
              fi
            fi
          done
          
          # è®¡ç®—åŒæ­¥ç”¨æ—¶
          SYNC_END_TIME=$(date +%s)
          SYNC_DURATION=$((SYNC_END_TIME - SYNC_START_TIME))
          
          if [ "$SUCCESS" = true ]; then
            echo ""
            echo "ğŸ‰ ä¼ä¸šçº§åŒæ­¥å®Œæˆ"
            echo "=================="
            echo "âœ… åŒæ­¥çŠ¶æ€: æˆåŠŸ"
            echo "â±ï¸ æ€»ç”¨æ—¶: ${SYNC_DURATION}ç§’"
            echo "ğŸ”„ é‡è¯•æ¬¡æ•°: $attempt"
            echo "ğŸ“¦ åŒæ­¥å†…å®¹: $CURRENT_COMMIT_SHORT ($COMMIT_MESSAGE)"
            
            # è®¾ç½®è¾“å‡ºå˜é‡
            echo "sync_status=success" >> $GITHUB_OUTPUT
            echo "sync_duration=$SYNC_DURATION" >> $GITHUB_OUTPUT
            echo "retry_count=$attempt" >> $GITHUB_OUTPUT
            echo "sync_id=$SYNC_ID" >> $GITHUB_OUTPUT
            echo "commit_hash=$CURRENT_COMMIT_SHORT" >> $GITHUB_OUTPUT
          else
            echo ""
            echo "ğŸš¨ ä¼ä¸šçº§åŒæ­¥å¤±è´¥"
            echo "=================="
            echo "âŒ åŒæ­¥çŠ¶æ€: å¤±è´¥"
            echo "â±ï¸ æ€»ç”¨æ—¶: ${SYNC_DURATION}ç§’"
            echo "ğŸ”„ å°è¯•æ¬¡æ•°: ${{ env.MAX_RETRY_COUNT }}"
            
            echo "sync_status=failed" >> $GITHUB_OUTPUT
            echo "sync_duration=$SYNC_DURATION" >> $GITHUB_OUTPUT
            echo "retry_count=${{ env.MAX_RETRY_COUNT }}" >> $GITHUB_OUTPUT
            echo "sync_id=$SYNC_ID" >> $GITHUB_OUTPUT
            
            # ä¼ä¸šçº§é”™è¯¯å¤„ç†
            if [[ "${{ env.BACKUP_ENABLED }}" == "true" ]]; then
              echo "ğŸ”„ è‡ªåŠ¨å›æ»šåˆ°å¤‡ä»½ç‚¹..."
              # è¿™é‡Œå¯ä»¥æ·»åŠ å›æ»šé€»è¾‘
              echo "ğŸ’¾ å¤‡ä»½æ ‡ç­¾å¯ç”¨: backup-before-$SYNC_ID"
            fi
            
            exit 1
          fi
        env:
          GITEE_TOKEN: ${{ secrets.GITEE_PASSWORD }}
          
      - name: ğŸ“Š ä¼ä¸šçº§åŒæ­¥æŠ¥å‘Š
        if: always()
        run: |
          echo "ğŸ¢ GitSync-Bridge v3.0 ä¼ä¸šçº§åŒæ­¥æŠ¥å‘Š"
          echo "======================================"
          echo "ğŸ†” åŒæ­¥ID: ${{ steps.enterprise_sync.outputs.sync_id }}"
          echo "ğŸ•’ æŠ¥å‘Šæ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')"
          echo "ğŸ”„ è§¦å‘äº‹ä»¶: ${{ github.event_name }}"
          echo "ğŸ‘¤ è§¦å‘ç”¨æˆ·: ${{ github.actor }}"
          echo ""
          echo "ğŸ“Š æ‰§è¡Œç»Ÿè®¡:"
          echo "  - åŒæ­¥çŠ¶æ€: ${{ steps.enterprise_sync.outputs.sync_status || 'æœªæ‰§è¡Œ' }}"
          echo "  - æ‰§è¡Œæ—¶é•¿: ${{ steps.enterprise_sync.outputs.sync_duration || '0' }}ç§’"
          echo "  - é‡è¯•æ¬¡æ•°: ${{ steps.enterprise_sync.outputs.retry_count || '0' }}"
          echo "  - æäº¤å“ˆå¸Œ: ${{ steps.enterprise_sync.outputs.commit_hash || 'N/A' }}"
          echo ""
          echo "ğŸŒ ç¯å¢ƒä¿¡æ¯:"
          echo "  - ç½‘ç»œè´¨é‡: ${{ needs.enterprise-precheck.outputs.network_quality }}%"
          echo "  - å®‰å…¨è¯„åˆ†: ${{ needs.enterprise-precheck.outputs.security_check }}/100"
          echo ""
          echo "ğŸ”— è®¿é—®é“¾æ¥:"
          echo "  - GitHubä»“åº“: https://github.com/${{ github.repository }}"
          echo "  - Giteeä»“åº“: https://gitee.com/${{ env.GITEE_USERNAME }}/${{ env.GITEE_REPO }}"
          echo "  - Actionsæ—¥å¿—: https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}"
          echo ""
          echo "ğŸ¢ GitSync-Bridge Enterprise - ä¸“ä¸šå¯é çš„ä¼ä¸šçº§è§£å†³æ–¹æ¡ˆ"

  # Job 3: é€šçŸ¥ç³»ç»Ÿ
  enterprise-notification:
    needs: [enterprise-precheck, enterprise-github-to-gitee]
    if: always() && (needs.enterprise-github-to-gitee.result == 'failure' || inputs.notification_level == 'all')
    runs-on: ubuntu-latest
    name: ğŸ“¢ ä¼ä¸šé€šçŸ¥ç³»ç»Ÿ
    
    steps:
      - name: ğŸ“§ å‘é€ä¼ä¸šé€šçŸ¥
        run: |
          echo "ğŸ“¢ GitSync-Bridge ä¼ä¸šé€šçŸ¥ç³»ç»Ÿ"
          echo "==============================="
          
          # ç¡®å®šé€šçŸ¥ç±»å‹
          if [[ "${{ needs.enterprise-github-to-gitee.result }}" == "success" ]]; then
            NOTIFICATION_TYPE="success"
            NOTIFICATION_ICON="âœ…"
            NOTIFICATION_COLOR="green"
          elif [[ "${{ needs.enterprise-github-to-gitee.result }}" == "failure" ]]; then
            NOTIFICATION_TYPE="error"
            NOTIFICATION_ICON="âŒ"
            NOTIFICATION_COLOR="red"
          else
            NOTIFICATION_TYPE="info"
            NOTIFICATION_ICON="â„¹ï¸"
            NOTIFICATION_COLOR="blue"
          fi
          
          echo "ğŸ“Š é€šçŸ¥ä¿¡æ¯:"
          echo "  - ç±»å‹: $NOTIFICATION_TYPE"
          echo "  - çŠ¶æ€: ${{ needs.enterprise-github-to-gitee.result }}"
          echo "  - æ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S')"
          echo ""
          
          # ç”Ÿæˆé€šçŸ¥å†…å®¹
          NOTIFICATION_TITLE="$NOTIFICATION_ICON GitSync-Bridge ä¼ä¸šåŒæ­¥é€šçŸ¥"
          NOTIFICATION_BODY="
          ğŸ¢ **ä¼ä¸šä»“åº“**: ${{ github.repository }}
          ğŸ”„ **åŒæ­¥çŠ¶æ€**: ${{ needs.enterprise-github-to-gitee.result }}
          ğŸ•’ **æ‰§è¡Œæ—¶é—´**: $(date '+%Y-%m-%d %H:%M:%S')
          ğŸ‘¤ **è§¦å‘ç”¨æˆ·**: ${{ github.actor }}
          ğŸ†” **è¿è¡ŒID**: ${{ github.run_id }}
          
          ğŸ“Š **è¯¦ç»†ä¿¡æ¯**:
          - ç½‘ç»œè´¨é‡: ${{ needs.enterprise-precheck.outputs.network_quality }}%
          - å®‰å…¨è¯„åˆ†: ${{ needs.enterprise-precheck.outputs.security_check }}/100
          
          ğŸ”— **æŸ¥çœ‹è¯¦æƒ…**: https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}
          "
          
          echo "ğŸ“ é€šçŸ¥å†…å®¹å·²å‡†å¤‡:"
          echo "$NOTIFICATION_BODY"
          
          # è¿™é‡Œå¯ä»¥é›†æˆå®é™…çš„é€šçŸ¥æœåŠ¡
          # ä¾‹å¦‚: ä¼ä¸šå¾®ä¿¡ã€é’‰é’‰ã€Slackã€é‚®ä»¶ç­‰
          echo ""
          echo "ğŸ“¤ é€šçŸ¥å‘é€å®Œæˆ (æ¨¡æ‹Ÿ)"

  # Job 4: ä¼ä¸šçº§ç›‘æ§å’ŒæŠ¥å‘Š
  enterprise-monitoring:
    needs: [enterprise-precheck, enterprise-github-to-gitee, enterprise-notification]
    if: always()
    runs-on: ubuntu-latest
    name: ğŸ“Š ä¼ä¸šç›‘æ§
    
    steps:
      - name: ğŸ“ˆ ç”Ÿæˆä¼ä¸šçº§ç›‘æ§æŠ¥å‘Š
        run: |
          echo "ğŸ“Š GitSync-Bridge v3.0 ä¼ä¸šçº§ç›‘æ§æŠ¥å‘Š"
          echo "======================================"
          echo "ğŸ“… æŠ¥å‘Šæ—¥æœŸ: $(date '+%Y-%m-%d')"
          echo "ğŸ•’ æŠ¥å‘Šæ—¶é—´: $(date '+%H:%M:%S')"
          echo "ğŸ¢ ä¼ä¸šæ¨¡å¼: ${{ env.ENTERPRISE_MODE }}"
          echo ""
          
          # ä»»åŠ¡æ‰§è¡Œç»Ÿè®¡
          echo "ğŸ“‹ ä»»åŠ¡æ‰§è¡Œç»Ÿè®¡:"
          echo "  - é¢„æ£€æŸ¥: ${{ needs.enterprise-precheck.result }}"
          echo "  - ä¸»åŒæ­¥: ${{ needs.enterprise-github-to-gitee.result }}"
          echo "  - é€šçŸ¥ç³»ç»Ÿ: ${{ needs.enterprise-notification.result }}"
          echo ""
          
          # æ€§èƒ½æŒ‡æ ‡
          echo "âš¡ æ€§èƒ½æŒ‡æ ‡:"
          echo "  - ç½‘ç»œè´¨é‡: ${{ needs.enterprise-precheck.outputs.network_quality }}%"
          echo "  - å®‰å…¨è¯„åˆ†: ${{ needs.enterprise-precheck.outputs.security_check }}/100"
          echo "  - æœ€å¤§é‡è¯•: ${{ env.MAX_RETRY_COUNT }}"
          echo "  - åŒæ­¥è¶…æ—¶: ${{ env.SYNC_TIMEOUT }}ç§’"
          echo ""
          
          # è®¡ç®—æ€»ä½“å¥åº·åº¦
          TOTAL_JOBS=3
          SUCCESS_JOBS=0
          
          [[ "${{ needs.enterprise-precheck.result }}" == "success" ]] && ((SUCCESS_JOBS++))
          [[ "${{ needs.enterprise-github-to-gitee.result }}" == "success" ]] && ((SUCCESS_JOBS++))
          [[ "${{ needs.enterprise-notification.result }}" != "failure" ]] && ((SUCCESS_JOBS++))
          
          HEALTH_SCORE=$((SUCCESS_JOBS * 100 / TOTAL_JOBS))
          
          echo "ğŸ¥ ç³»ç»Ÿå¥åº·åº¦: $HEALTH_SCORE%"
          
          if [ $HEALTH_SCORE -ge 90 ]; then
            echo "âœ… ç³»ç»ŸçŠ¶æ€: ä¼˜ç§€"
          elif [ $HEALTH_SCORE -ge 70 ]; then
            echo "âœ… ç³»ç»ŸçŠ¶æ€: è‰¯å¥½"  
          elif [ $HEALTH_SCORE -ge 50 ]; then
            echo "âš ï¸ ç³»ç»ŸçŠ¶æ€: ä¸€èˆ¬"
          else
            echo "âŒ ç³»ç»ŸçŠ¶æ€: éœ€è¦å…³æ³¨"
          fi
          
          echo ""
          echo "ğŸ“ˆ ç›‘æ§å»ºè®®:"
          if [ $HEALTH_SCORE -lt 80 ]; then
            echo "  - å»ºè®®æ£€æŸ¥ç½‘ç»œè¿æ¥è´¨é‡"
            echo "  - å»ºè®®æ£€æŸ¥è®¤è¯ä¿¡æ¯é…ç½®"
            echo "  - è€ƒè™‘å¢åŠ é‡è¯•æ¬¡æ•°"
          else
            echo "  - ç³»ç»Ÿè¿è¡Œè‰¯å¥½ï¼Œç»§ç»­ç›‘æ§"
          fi
          
          echo ""
          echo "ğŸ”— ä¼ä¸šçº§é“¾æ¥:"
          echo "  - ç›‘æ§é¢æ¿: https://github.com/${{ github.repository }}/actions"
          echo "  - é—®é¢˜åé¦ˆ: https://github.com/${{ github.repository }}/issues"
          echo "  - æŠ€æœ¯æ”¯æŒ: enterprise@gitsync-bridge.com"
          echo ""
          echo "ğŸ¢ GitSync-Bridge Enterprise v3.0 - å€¼å¾—ä¿¡èµ–çš„ä¼ä¸šçº§æ–¹æ¡ˆ"